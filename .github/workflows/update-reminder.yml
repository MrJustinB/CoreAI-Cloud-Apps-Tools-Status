name: Monthly Update Reminder

on:
  schedule:
    - cron: '0 9 1 * *'
  workflow_dispatch:

jobs:
  send-reminder:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Create monthly reminder issue
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const data = JSON.parse(fs.readFileSync('reporting/data/projects.json', 'utf8'));
            const now = new Date();
            const monthYear = now.toLocaleString('en-US', { month: 'long', year: 'numeric' });
            const title = `üìã Monthly project status update reminder ‚Äî ${monthYear}`;

            let projectList = '';
            for (const project of data.projects) {
              projectList += `| ${project.name} | ${project.engLead} | ${project.pmLead} | ${project.status} |\n`;
            }

            const body = [
              `## üìã Monthly Status Update Reminder`,
              ``,
              `It's time to update your project status for **${monthYear}**.`,
              ``,
              `### Projects`,
              ``,
              `| Project | Eng Lead | PM Lead | Current Status |`,
              `|---------|----------|---------|----------------|`,
              projectList.trimEnd(),
              ``,
              `### How to Update`,
              `1. Edit \`reporting/data/projects.json\` with your latest status`,
              `2. Update the \`updatedAt\` field to today's date`,
              `3. Open a PR using the **status-update** PR template`,
              ``,
              `Thank you for keeping our project tracking up to date! üôè`
            ].join('\n');

            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: title,
              body: body,
              labels: ['status-update']
            });

            console.log(`Created monthly reminder issue: ${title}`);
